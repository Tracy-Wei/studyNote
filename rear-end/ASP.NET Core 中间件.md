## ASP.NET Core 中间件

中间件是一种装配到应用管道以处理请求和响应的软件。

每个组件：

- 选择是否将请求传递到管道中的下一个组件。
- 可在管道中的下一个组件前后执行工作。

请求委托用于生成请求管道。请求委托处理每个 HTTP 请求。

中间件:也叫中间件组件.使用 RunMap 和 Use 扩展方法来配置请求委托。 可将一个单独的请求委托并行指定为匿名方法（称为并行中间件），或在可重用的类中对其进行定义。 这些可重用的类和并行匿名方法即为中间件.

用处：请求管道中的每个中间件组件负责调用管道中的下一个组件，或使管道短路。

终端中间件：当中间件短路时，它被称为“终端中间件”，因为它阻止中间件进一步处理请求。

### 使用 WebApplication 创建中间件管道

ASP.NET Core 请求管道包含一系列请求委托，依次调用。
![image](https://github.com/Tracy-Wei/studyNote/assets/109784975/b0c90e77-69dd-4566-9c75-a33cfe400de0)
每个委托均可在下一个委托前后执行操作。 应尽早在管道中调用异常处理委托，这样它们就能捕获在管道的后期阶段发生的异常。

### 中间件顺序

下图显示了 ASP.NET Core MVC 和 Razor Pages 应用的完整请求处理管道。
![image](https://github.com/Tracy-Wei/studyNote/assets/109784975/4553760f-1813-440d-b0ad-5cc42a482cd1)
上图中的“终结点”中间件为相应的应用类型（MVC 或 Razor Pages）执行筛选器管道
